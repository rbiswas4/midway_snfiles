June 2018
R. Hlozek
D. Scolnic

1) SIMULATING LSST SUPERNOVAE

a) survey specifications

The first step is to simulate the three relevant surveys:
* DDF Y1 (assuming a solid angle of 0.0145, NGEN UNIT = 0.005, 20 RANSEEDS, z from 0.05 to 1.4, since low-z is Foundation)
* DDF Y10 (assuming a solid angle of 0.0145, NGEN UNIT = 0.05, 20 RANSEEDS, z from  0.05 to 1.4, since low-z is Foundation)
* WFD Y10 (assuming a solid angle of 5.08, NGEN UNIT = 0.05, 20 RANSEEDS, z from  0.05 to  1.1, since low-z is Foundation)

Note that the full survey amount is computed as
NGEN UNIT x # of RANSEEDs x fraction of solid angle for each survey


* For the WFD survey, the NGEN UNIT is adjusted to be 0.005 to be a 1/10 scale factor for the total number of fibres for a 4MOST-like survey.

b) quality cuts

In addition, there is a quality cut on objects that we would put fibres on of only objects with three epochs that have SNR>5.  An epoch is based on a detection where detection likelihood is based on DES.


c) type

For the initial LSST SRD we assume only Type Ia supernovae.

d) model assumptions + astrophysical systematics

The baseline case has the G10 scatter model.  Within one simulation, we generate all the different systematic versions. For the v1 LSST SRD, these are:

* POPULATION DRIFT with a GENOPT using a ZVARIATION_POLY   GENPEAK_SALT2c  0 0.01 0 0 (identified by _G10_POP)
* HOST MASS STEP described by the ZVARIATION_FILE lsst_sys_host.txt and a GENMAG_OFF_GLOBAL of 0.00022036 (identified by _G10_HOST)
* C11 Intrinsic scatter model with the properties of the scatter model described in Scolnic et al, and summarised as:
GENOPT(Ia): GENMAG_SMEAR_MODELNAME C11_0
GENOPT(Ia): GENPEAK_SALT2c  -0.099
GENOPT(Ia): GENRANGE_SALT2c -0.4   0.5
GENOPT(Ia): GENSIGMA_SALT2c 0.003   0.119
GENOPT(Ia): GENPEAK_SALT2x1 0.964
GENOPT(Ia): GENRANGE_SALT2x1 -4.0   4.0
GENOPT(Ia): GENSIGMA_SALT2x1 1.467   0.235
GENOPT(Ia): GENALPHA_SALT2 0.14
GENOPT(Ia): GENBETA_SALT2 3.7

These are identified by _C11

The relevant simulation files are given as files with GENVERSION:

SIMGEN_MASTER_LSST_DDF_Y1.INPUT
SIMGEN_MASTER_LSST_DDF_Y10.INPUT
SIMGEN_MASTER_LSST_WFD_Y10.INPUT

e) general assumptions

Contained within the INPUT files are calls to

SIMGEN_SALT2_POPCHAR.INPUT

which specifies the SN population characteristics, the detection thresholds/criteria and the cosmology.
Care must be taken here to specify the search efficiency files, and also if only a software trigger or an additional redshift etc. are required to "accept" a particular light curve.

The opsim version used is the coadded minion simulation, which is found in:
$LSST_ROOT/simlibs/minion_1016_DDF.simlib.COADD

f) running the simulations

The SN simulations are generated with the SNANA command:

sim_SNmix.pl simfile.INPUT

where simfile.INPUT are the ones listed above for the different survey configurations.

In addition, we simulate a separate low-z sample that contains numbers based on a Foundation-like survey (as a note, in the previous simulation, this was included but slightly hidden as within the LSST low-z numbers, and so would have been subject to the same spectroscopic efficiency corrections we applied to the sample based on Jeff Newman's numbers).

This is generated by running sim_SNmix.pl SIMGEN_MASTER_FOUNDATION.INPUT

2) FITTING THE OUTPUT LIGHTCURVES

Once the data are simulated, the light curves are fit for each set of observations.
These are the fit separately for the DDF and the WFD (and Foundation)

NML files (split_and_fit.pl):
 DS_Ia_DDF_Y1_SYS.NML
 DS_Ia_DDF_Y10_SYS.NML
 DS_Ia_WFD_SYS.NML
 Foundation.NML

This results in biascore (ie. the main data file) being generated, as well as the systematics files whiles which are going to be used to compute the difference in mus for the data.

As such, we then need to cat the files together for the systematics of the low-z and the Y1 or Y10 samples, so they are combined with the Foundation systematics.

This is done with the:

cat_Y1.sh
cat_Y10.sh

Dan: for cat_Y1.sh, Dan used the DDF Y10 for the biascor so there is good statistics (10x more) in the biascorrection.

which contatenate all the files together to make the relevant fitres files that will be fit in the next step.

In the LSST NML file you need all the names of the systematics of the lowz sample, but point them to fitopt because they don't do anything

Then I ran SALT2mu_fit.pl to convert to distances
SALT2mu_muopt_oned_Y1.input
SALT2mu_muopt_oned_Y10.input
*We make final quality cut of sig(t0)<2,sig(x1)<1,sig(c)<0.08 to ensure high quality distances.

Then I run
run python Python/create_covariance.py inFile SYSTEMATICS_OPTIONS

where the SYSTEMATICS_OPTIONS are then modified to include the systematics options (eg. scaling) of the systematics